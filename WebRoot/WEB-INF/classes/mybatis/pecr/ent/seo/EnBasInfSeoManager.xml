<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EnBasInfSeoManager">
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EnBasInf" id="enBasInfResultMap">
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/>
		<result column="inf_rec_type" property="infRecType"/> 
		<result column="ent_name" property="entName"/> 
		<result column="ent_cert_type" property="entCertType"/>
		<result column="ent_cert_num" property="entCertNum"/> 
		<result column="rpt_date" property="rptDate"/> 
		<result column="rpt_date_code" property="rptDateCode"/> 
		<result column="inf_surc_code" property="infSurcCode"/>
		<result column="cimoc" property="cimoc"/> 
		<result column="customer_type" property="customerType"/> 
		<result column="etp_sts" property="etpSts"/>
		<result column="org_type" property="orgType"/>
		<result column="last_update_time" property="lastUpdateTime"/>
		<result column="operator_user" property="operatorUser"/>
		<result column="org_name" property="orgName"/>
		<result column="org_code" property="orgCode"/>
		<result column="business_states" property="businessStates"/>
		<result column="reject_reason" property="rejectReason"/>
		<result column="is_filter" property="isFilter"/>
		<result column="report_message_id" property="reportMessageId"/>
		<result column="FLAG" property="flag"/>
		<result column="mdfc_sgmt_code" property="mdfcSgmtCode"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntIdSgmt" id="entIdSgmtResultMap">
		<result column="eab_id_sgmt_id" property="eabIdSgmtId"/>
		<result column="oth_ent_cert_type" property="othEntCertType"/> 
		<result column="oth_ent_cert_num" property="othEntCertNum"/> 
		<result column="id_info_up_date" property="idInfoUpDate"/>
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/> 
		<result column="rpt_date" property="rptDate"/> 
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntFcsInfSgmt" id="entFcsInfSgmtResultMap">
		<result column="eac_fcs_inf_sgmt_id" property="eacFcsInfSgmtId"/>
		<result column="nationality" property="nationality"/> 
		<result column="reg_add" property="regAdd"/> 
		<result column="adm_div_of_reg" property="admDivOfReg"/>
		<result column="establish_date" property="establishDate"/> 
		<result column="biz_end_date" property="bizEndDate"/> 
		<result column="biz_range" property="bizRange"/> 
		<result column="eco_indus_cate" property="ecoIndusCate"/>
		<result column="eco_type" property="ecoType"/> 
		<result column="ent_scale" property="entScale"/> 
		<result column="fcs_info_up_date" property="fcsInfoUpDate"/>
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/>
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntMnMmbInfSgmt" id="entMnMmbInfSgmtResultMap">
		<result column="ead_mn_mmb_inf_sgmt_id" property="eadMnMmbInfSgmtId"/>
		<result column="mmb_alias" property="mmbAlias"/> 
		<result column="mmb_id_type" property="mmbIdType"/> 
		<result column="mmb_id_num" property="mmbIdNum"/>
		<result column="mmb_pstn" property="mmbPstn"/> 
		<result column="mn_mmb_info_update" property="mnMmbInfoUpdate"/> 
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/> 
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntMnShaHodInfSgmt" id="entMnShaHodInfSgmtResultMap">
		<result column="eae_mn_sha_hod_inf_sgmt_id" property="eaeMnShaHodInfSgmtId"/>
		<result column="reg_cap_currency" property="regCapCurrency"/> 
		<result column="reg_cap" property="regCap"/> 
		<result column="shar_hod_type" property="sharHodType"/>
		<result column="shar_hod_cert_type" property="sharHodCertType"/> 
		<result column="shar_hod_name" property="sharHodName"/> 
		<result column="shar_hod_id_type" property="sharHodIdType"/> 
		<result column="shar_hod_id_num" property="sharHodIdNum"/>
		<result column="inv_ratio" property="invRatio"/> 
		<result column="mn_sha_hod_info_up_date" property="mnShaHodInfoUpDate"/> 
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/>
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntActuCotrlInfSgmt" id="entActuCotrlInfSgmtResultMap">
		<result column="eaf_actu_cotrl_inf_sgmt_id" property="eafActuCotrlInfSgmtId"/>
		<result column="actu_cotrl_cert_type" property="actuCotrlCertType"/> 
		<result column="actu_cotrl_name" property="actuCotrlName"/> 
		<result column="actu_cotrl_id_type" property="actuCotrlIdType"/>
		<result column="actu_cotrl_id_num" property="actuCotrlIdNum"/> 
		<result column="actu_cotrl_info_update" property="actuCotrlInfoUpdate"/> 
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/> 
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntSpvsgAthrtyInfSgmt" id="entSpvsgAthrtyInfSgmtResultMap">
		<result column="eag_spvsg_athrty_inf_sgmt_id" property="eagSpvsgAthrtyInfSgmtId"/>
		<result column="sup_org_type" property="supOrgType"/> 
		<result column="sup_org_name" property="supOrgName"/> 
		<result column="sup_org_cert_type" property="supOrgCertType"/>
		<result column="sup_org_cert_num" property="supOrgCertNum"/> 
		<result column="sup_org_info_up_date" property="supOrgInfoUpDate"/> 
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/> 
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<resultMap type="com.dcits.supervise.pecr.ent.entity.EntCotaInfSgmt" id="entCotaInfSgmtResultMap">
		<result column="eah_cota_inf_sgmt_id" property="eahCotaInfSgmtId"/>
		<result column="con_add_district_code" property="conAddDistrictCcode"/> 
		<result column="con_add" property="conAdd"/> 
		<result column="con_phone" property="conPhone"/>
		<result column="fin_con_phone" property="finConPhone"/> 
		<result column="cota_info_up_date" property="cotaInfoUpDate"/> 
		<result column="eaa_bs_sgmt_id" property="eaaBsSgmtId"/> 
		<result column="rpt_date" property="rptDate"/>
	</resultMap>
	<select id="datalistPage" parameterType="page" resultType="pd">
		  select 
			 ENT_CERT_TYPE,ENT_CERT_NUM,COMPANY
		  from E_BS_MIDDLE
		  <if test="pd.managerId != null and pd.managerId != ''">
				LEFT JOIN PECR.sys_l_c_a_m_m M
				ON E_BS_MIDDLE.ENT_CERT_TYPE = M.CUST_ID_TYPE
				AND E_BS_MIDDLE.ENT_CERT_NUM = M.CUST_ID_NUM
		  </if>
		  where 1=1		
		   	  <if test='pd.ENT_CERT_NUM != null and pd.ENT_CERT_NUM != ""'>
		   	  	and ENT_CERT_NUM like '%${pd.ENT_CERT_NUM}%'
		   	  </if>
		   	  <if test='pd.ENT_CERT_TYPE != null and pd.ENT_CERT_TYPE != ""'>
		   	  	and ENT_CERT_TYPE = #{pd.ENT_CERT_TYPE}
		   	  </if>
		   	  <if test="pd.managerId != null and pd.managerId != ''">
					and M.MANAGER_ID = #{pd.managerId}
					AND M.DATA_TYPE = '2'
					AND M.DATA_LEVEL = '1'
		   			AND M.END_DATE = '2099-12-31'
			  </if>
	
		   	    and COMPANY = #{pd.COMPANY}
	</select>
	<!-- 授信协议信息  数据列表 -->
	<select id="dataHistlistPage" parameterType="page" resultMap="enBasInfResultMap">
	select * from (
		 select  eaa_bs_sgmt_id 
				  ,inf_rec_type 
				  ,ent_name 
				  ,ent_cert_type 
				  ,ent_cert_num 
				  ,rpt_date 
				  ,rpt_date_code 
				  ,inf_surc_code 
				  ,cimoc 
				  ,customer_type 
				  ,etp_sts 
				  ,org_type 
				  ,last_update_time 
				  ,operator_user 
				  ,org_name 
				  ,org_code 
				  ,business_states 
				  ,reject_reason 
				  ,is_filter 
				  ,report_message_id 
				  ,'new' FLAG
				  ,COMPANY
		   from E_BS
		where ent_cert_type = #{pd.ENT_CERT_TYPE}  and     ent_cert_num = #{pd.ENT_CERT_NUM} 
		union all
		select eaa_bs_sgmt_id 
				  ,inf_rec_type 
				  ,ent_name 
				  ,ent_cert_type 
				  ,ent_cert_num 
				  ,rpt_date 
				  ,rpt_date_code 
				  ,inf_surc_code 
				  ,cimoc 
				  ,customer_type 
				  ,etp_sts 
				  ,org_type 
				  ,last_update_time 
				  ,operator_user 
				  ,org_name 
				  ,org_code 
				  ,business_states 
				  ,reject_reason 
				  ,is_filter 
				  ,report_message_id 
				  ,'old' FLAG
				  ,COMPANY
		   from E_BS_hist   
		where ent_cert_type = #{pd.ENT_CERT_TYPE}  and     ent_cert_num = #{pd.ENT_CERT_NUM}) a
		where 1=1
		   	  <if test='pd.RPT_DATE != null and pd.RPT_DATE != ""'>
		   	  	and a.rpt_date = #{pd.RPT_DATE}
		   	  </if>
		   	    and a.COMPANY = #{pd.COMPANY}
	</select>

	<!-- 企业基本信息记录 基础段信息 -->
	<select id="getEntBsSgmtData" parameterType="pd" resultType="pd">
		 select eaa_bs_sgmt_id 
				  ,inf_rec_type 
				  ,ent_name 
				  ,ent_cert_type 
				  ,ent_cert_num 
				  ,rpt_date 
				  ,rpt_date_code 
				  ,inf_surc_code 
				  ,cimoc 
				  ,customer_type 
				  ,etp_sts 
				  ,org_type 
				  ,last_update_time 
				  ,operator_user 
				  ,org_name 
				  ,org_code 
				  ,business_states 
				  ,reject_reason 
				  ,is_filter 
				  ,report_message_id
				  ,COMPANY 
		   from E_BS_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
		    and COMPANY = #{COMPANY}
	</select>
	
<!-- 详情或者修改  查询指定记录  其他标识信息段-->
	<select id="getentIdSgmtById" parameterType="pd" resultMap="entIdSgmtResultMap">
		 select   eab_id_sgmt_id 
				  ,oth_ent_cert_type 
				  ,oth_ent_cert_num 
				  ,id_info_up_date 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date 
				  ,COMPANY
		   from E_ID_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  基本概况信息段-->
	<select id="getentFcsInfSgmtById" parameterType="pd" resultType="pd">
		 select   eac_fcs_inf_sgmt_id 
				  ,nationality 
				  ,reg_add 
				  ,adm_div_of_reg 
				  ,establish_date as  establish_date
				  ,biz_end_date as  biz_end_date
				  ,biz_range 
				  ,eco_indus_cate 
				  ,eco_type 
				  ,ent_scale 
				  ,fcs_info_up_date 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date 
				  ,COMPANY
		   from E_FCS_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  主要组成人员段-->
	<select id="getentMnMmbInfSgmtById" parameterType="pd" resultMap="entMnMmbInfSgmtResultMap">
		 select   ead_mn_mmb_inf_sgmt_id 
				  ,mmb_alias 
				  ,mmb_id_type 
				  ,mmb_id_num 
				  ,mmb_pstn 
				  ,mn_mmb_info_update 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date
				  ,COMPANY
		   from E_MN_MMB_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  注册资本及主要出资人段-->
	<select id="getentMnShaHodInfSgmtById" parameterType="pd" resultMap="entMnShaHodInfSgmtResultMap">
		 select   eae_mn_sha_hod_inf_sgmt_id 
				  ,reg_cap_currency 
				  ,reg_cap 
				  ,shar_hod_type 
				  ,shar_hod_cert_type 
				  ,shar_hod_name 
				  ,shar_hod_id_type 
				  ,shar_hod_id_num 
				  ,inv_ratio 
				  ,mn_sha_hod_info_up_date 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date
				  ,COMPANY
		   from E_MN_SHA_HOD_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  实际控制人段-->
	<select id="getentActuCotrlInfSgmtById" parameterType="pd" resultMap="entActuCotrlInfSgmtResultMap">
		 select   eaf_actu_cotrl_inf_sgmt_id 
				  ,actu_cotrl_cert_type 
				  ,actu_cotrl_name 
				  ,actu_cotrl_id_type 
				  ,actu_cotrl_id_num 
				  ,actu_cotrl_info_update 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date
				  ,COMPANY
		   from E_ACTU_COTRL_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  上级机构段-->
	<select id="getentSpvsgAthrtyInfSgmtById" parameterType="pd" resultType="pd">
		 select   eag_spvsg_athrty_inf_sgmt_id 
				  ,sup_org_type 
				  ,sup_org_name 
				  ,sup_org_cert_type 
				  ,sup_org_cert_num 
				  ,sup_org_info_up_date 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date 
				  ,COMPANY
		   from E_SPVSG_ATHRTY_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	<!-- 详情或者修改  查询指定记录  联系方式段-->
	<select id="getentCotaInfSgmtById" parameterType="pd" resultType="pd">
		 select   eah_cota_inf_sgmt_id 
				  ,con_add_district_code 
				  ,con_add 
				  ,con_phone 
				  ,fin_con_phone 
				  ,cota_info_up_date 
				  ,eaa_bs_sgmt_id 
				  ,rpt_date
				  ,COMPANY
		   from E_COTA_INF_hist
		  where eaa_bs_sgmt_id = #{eaaBsSgmtId}
	</select>
	
<update id="updateStatus" parameterType="map">
		update E_BS
		   <set>
		   	  	BUSINESS_STATES = '11'
		   </set>
		   where eaa_bs_sgmt_id = #{baseId}
		     and COMPANY = #{COMPANY}
</update>
<update id="backdate" parameterType="map">
		update E_BS
		   <set>
		   	  	BUSINESS_STATES = '30'
		   </set>
		   where REPORT_MESSAGE_ID = #{reportMessageId}
		     and COMPANY = #{COMPANY}
</update>
<delete id="deletedate" parameterType="map" >
		delete from report_message
		 where REPORT_MESSAGE_FILE_NAME = #{reportMessageId}
		   and COMPANY = #{COMPANY}
</delete>
</mapper>
